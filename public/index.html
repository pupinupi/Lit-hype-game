<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>–õ–∏—Ç–≤–∏–Ω. –ü—É—Ç—å –∫ —Ö–∞–π–ø—É</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<style>
body{font-family:Arial;text-align:center;background:#111;color:white;}
#lobby, #game{margin:20px;}
button{padding:10px 20px;margin:5px;font-size:16px;}
button:disabled{opacity:0.5;cursor:not-allowed;}
#board-container{position:relative;width:1024px;height:1024px;margin:20px auto;}
#board{width:100%;height:100%;}
.piece{width:30px;height:30px;border-radius:50%;position:absolute;transition:left 0.4s linear, top 0.4s linear;}
.yellow{background:yellow;}
.red{background:red;}
.blue{background:blue;}
.purple{background:purple;}
#dice-container{margin:20px auto; cursor:pointer;}
.dice-face{display:inline-block;width:50px;height:50px;background:white;margin:2px;position:relative;border-radius:5px;}
.dot{width:10px;height:10px;background:black;border-radius:50%;position:absolute;}
#popup{position:absolute;top:30%;left:50%;transform:translateX(-50%);
background:#222;padding:20px;border:2px solid #fff;border-radius:10px;display:none;color:white;z-index:100;}
.color-choice{display:inline-block;width:40px;height:40px;border-radius:50%;margin:5px;cursor:pointer;border:3px solid #fff;}
.selected{box-shadow:0 0 10px 5px gold;}
.highlight{box-shadow:0 0 20px 5px gold;border-radius:5px;}
</style>
</head>
<body>
<h1>–õ–∏—Ç–≤–∏–Ω. –ü—É—Ç—å –∫ —Ö–∞–π–ø—É</h1>

<div id="lobby">
<input id="name" placeholder="–ò–º—è"><br>
<input id="room" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã"><br>
<h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç —Ñ–∏—à–∫–∏</h3>
<div id="colors">
<div class="color-choice yellow" onclick="chooseColor('yellow')"></div>
<div class="color-choice red" onclick="chooseColor('red')"></div>
<div class="color-choice blue" onclick="chooseColor('blue')"></div>
<div class="color-choice purple" onclick="chooseColor('purple')"></div>
</div>
<button onclick="join()">–í–æ–π—Ç–∏</button>
</div>

<div id="game">
<h3 id="players"></h3>
<div id="board-container">
<img src="board.jpg" id="board">
</div>
<div id="dice-container" onclick="roll()">
<div id="dice" class="dice-face"></div>
</div>
<button id="roll-btn" onclick="roll()">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫</button>
<h3 id="info"></h3>
<div id="popup"></div>
</div>

<script>
const socket=io();
let playerColor="";
let currentRoom="";
let playerId="";
let pieces={};
let skipTurnFlag=false;
let positions=[[91,583],[102,450],[80,345],[99,232],[99,133],[218,97],[348,91],[500,88],[624,102],[762,91],[895,130],[912,204],[912,337],[909,425],[901,580],[771,588],[641,588],[483,594],[331,586],[218,594]];
const cellTypes=["start","h3","h2","scandal","risk","h2","scandal","h3","h5","zero","jail","h3","risk","h3","skip","h2","scandal","h8","zero","h4"];
const scandalTexts=["–ü–µ—Ä–µ–≥—Ä–µ–ª –∞—É–¥–∏—Ç–æ—Ä–∏—é üî• -1","–ì—Ä–æ–º–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ ü´£ -2","–≠—Ç–æ –º–æ–Ω—Ç–∞–∂ üò± -3","–ú–µ–Ω—è –≤–∑–ª–æ–º–∞–ª–∏ #Ô∏è‚É£ -3 –≤—Å–µ–º","–ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –≤ —à–æ–∫–µ üòÆ -4","–£–¥–∞–ª—è–π –ø–æ–∫–∞ –Ω–µ –ø–æ–∑–¥–Ω–æ ü§´ -5","–≠—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç, –≤—ã –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç–µ üôÑ -5 + –ø—Ä–æ–ø—É—Å—Ç–∏ —Ö–æ–¥"];

let chosenDiv=null;
function chooseColor(color){
  if(chosenDiv) chosenDiv.classList.remove("selected");
  const div=document.querySelector(`.color-choice.${color}`);
  div.classList.add("selected");
  chosenDiv=div;
  playerColor=color;
}

function join(){
  const name=document.getElementById("name").value;
  const room=document.getElementById("room").value;
  if(!name||!room||!playerColor) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –∏–º—è, –∫–æ–º–Ω–∞—Ç—É –∏ —Ü–≤–µ—Ç!");
  currentRoom=room;
  socket.emit("joinRoom",{name,room,color:playerColor});
  document.getElementById("lobby").style.display="none";
  document.getElementById("game").style.display="block";
}

function roll(){
  if(skipTurnFlag) return;
  const diceValue=Math.floor(Math.random()*6)+1;
  drawDice(diceValue);
  socket.emit("rollDice",{room:currentRoom, value:diceValue});
}

function drawDice(n){
  const dice=document.getElementById("dice");
  dice.innerHTML="";
  const dots=[
    [[20,20]],
    [[10,10],[30,30]],
    [[10,10],[20,20],[30,30]],
    [[10,10],[10,30],[30,10],[30,30]],
    [[10,10],[10,30],[20,20],[30,10],[30,30]],
    [[10,10],[10,20],[10,30],[30,10],[30,20],[30,30]]
  ];
  dots[n-1].forEach(p=>{
    let dot=document.createElement("div");
    dot.className="dot";
    dot.style.left=p[0]+"px";
    dot.style.top=p[1]+"px";
    dice.appendChild(dot);
  });
}

socket.on("updateRoom", game=>{
  let text="";
  skipTurnFlag=false;
  game.players.forEach(p=>{
    text+=p.name+" | –•–∞–π–ø: "+p.hype+"<br>";
    if(!pieces[p.id]){
      const div=document.createElement("div");
      div.className="piece "+p.color;
      div.style.left=positions[p.position][0]+"px";
      div.style.top=positions[p.position][1]+"px";
      document.getElementById("board-container").appendChild(div);
      pieces[p.id]=div;
    } else movePieceSmooth(p.id, positions[p.position]);

    if(p.skip && p.id===playerId) skipTurnFlag=true;
  });
  document.getElementById("players").innerHTML=text;
  const current=game.players[game.turn];
  document.getElementById("info").innerText="–•–æ–¥ –∏–≥—Ä–æ–∫–∞: "+current.name;
  highlightCell(current.position);
});

function movePieceSmooth(id,target){
  const el=pieces[id];
  el.style.left=target[0]+"px";
  el.style.top=target[1]+"px";
}

function highlightCell(pos){
  const board=document.getElementById("board");
  board.classList.remove("highlight");
  setTimeout(()=>board.classList.add("highlight"),100);
}

function showPopup(text){
  const popup=document.getElementById("popup");
  popup.innerText=text;
  popup.style.display="block";
  setTimeout(()=>popup.style.display="none",3000);
}

socket.on("showPopup", text=>showPopup(text));
socket.on("gameOver", winner=>alert("–ü–æ–±–µ–¥–∏–ª "+winner.name+" üéâ"));

</script>
</body>
</html>
