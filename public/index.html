<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>–õ–∏—Ç–≤–∏–Ω. –ü—É—Ç—å –∫ —Ö–∞–π–ø—É</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{
  font-family:Arial;
  text-align:center;
  background:#111;
  color:white;
}

#board{
  position:relative;
  width:1024px;
  height:1024px;
  margin:auto;
  background:url("board.jpg");
  background-size:cover;
}

.token{
  width:30px;
  height:30px;
  border-radius:50%;
  position:absolute;
  transition:all 0.3s linear;
}

.colorPick{
  width:30px;
  height:30px;
  border-radius:50%;
  display:inline-block;
  margin:5px;
  cursor:pointer;
  border:2px solid white;
}
</style>
</head>
<body>

<div id="lobby">
  <h2>–õ–∏—Ç–≤–∏–Ω. –ü—É—Ç—å –∫ —Ö–∞–π–ø—É</h2>

  <input id="nameInput" placeholder="–ò–º—è"><br><br>
  <input id="roomInput" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã"><br><br>

  <div>
    <div class="colorPick" style="background:yellow" onclick="setColor('yellow')"></div>
    <div class="colorPick" style="background:red" onclick="setColor('red')"></div>
    <div class="colorPick" style="background:blue" onclick="setColor('blue')"></div>
    <div class="colorPick" style="background:purple" onclick="setColor('purple')"></div>
  </div><br>

  <button onclick="joinRoom()">–í–æ–π—Ç–∏</button>
</div>

<div id="game" style="display:none;">
  <h3 id="turnInfo"></h3>
  <h3 id="hypeInfo"></h3>
  <div id="board"></div>
  <h2 id="dice">üé≤</h2>
  <button onclick="rollDice()">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫</button>
</div>

<script>
const socket = io();

let myId=null;
let gameState=null;
let myColor="yellow";
let currentRoom=null;

const positions = [
{x:91,y:583},
{x:102,y:450},
{x:80,y:345},
{x:99,y:232},
{x:99,y:133},
{x:218,y:97},
{x:348,y:91},
{x:500,y:88},
{x:624,y:102},
{x:762,y:91},
{x:895,y:130},
{x:912,y:204},
{x:912,y:337},
{x:909,y:425},
{x:901,y:580},
{x:771,y:588},
{x:641,y:588},
{x:483,y:594},
{x:331,y:586},
{x:218,y:594}
];

function setColor(c){ myColor=c; }

function joinRoom(){
  const name=document.getElementById("nameInput").value;
  const room=document.getElementById("roomInput").value;
  if(!name || !room) return alert("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ");

  currentRoom=room;
  socket.emit("joinRoom",{name,room,color:myColor});
  document.getElementById("lobby").style.display="none";
  document.getElementById("game").style.display="block";
}

socket.on("playerId",id=>myId=id);

socket.on("updateRoom",state=>{
  gameState=state;
  render();
});

socket.on("gameOver",w=>alert("–ü–æ–±–µ–¥–∏–ª: "+w.name));

function rollDice(){
  if(!gameState) return;
  const player=gameState.players[gameState.turn];
  if(player.id!==myId) return;
  socket.emit("rollDice",{room:currentRoom});
}

function render(){
  document.getElementById("dice").innerText = 
"üé≤ " + gameState.players[gameState.turn === 0 
? gameState.players.length-1 
: gameState.turn-1].lastDice;
  const board=document.getElementById("board");
  board.innerHTML="";

  const current=gameState.players[gameState.turn];
  document.getElementById("turnInfo").innerText="–•–æ–¥: "+current.name;

  let hypeText="";
  gameState.players.forEach(p=>{
    hypeText+=p.name+": "+p.hype+" | ";
  });
  document.getElementById("hypeInfo").innerText=hypeText;

  gameState.players.forEach(p=>{
    const token=document.createElement("div");
    token.className="token";
    token.style.background=p.color;

    const pos=positions[p.position];
    token.style.left=pos.x+"px";
    token.style.top=pos.y+"px";

    board.appendChild(token);
  });
}
</script>

</body>
</html>
