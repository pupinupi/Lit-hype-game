<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>–õ–∏—Ç–≤–∏–Ω. –ü—É—Ç—å –∫ —Ö–∞–π–ø—É</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<style>
body{font-family:Arial;text-align:center;background:#111;color:white;}
input,select{padding:8px;margin:5px;}
button{padding:10px 20px;margin:10px;font-size:18px;}
#game{display:none;}
#board-container{position:relative;width:1024px;height:1024px;margin:20px auto;}
#board{width:100%;height:100%;}
.piece{width:30px;height:30px;border-radius:50%;position:absolute;transition:left 0.5s linear, top 0.5s linear;}
.yellow{background:yellow;}
.red{background:red;}
.blue{background:blue;}
.purple{background:purple;}
#dice{font-size:50px;margin:10px;cursor:pointer;}
#popup{position:absolute;top:30%;left:50%;transform:translateX(-50%);
background:#222;padding:20px;border:2px solid #fff;border-radius:10px;display:none;color:white;z-index:100;}
</style>
</head>
<body>

<h1>–õ–∏—Ç–≤–∏–Ω. –ü—É—Ç—å –∫ —Ö–∞–π–ø—É</h1>
<div id="lobby">
<input id="name" placeholder="–ò–º—è"><br>
<input id="room" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã"><br>
<select id="color">
<option value="yellow">–ñ–µ–ª—Ç–∞—è</option>
<option value="red">–ö—Ä–∞—Å–Ω–∞—è</option>
<option value="blue">–°–∏–Ω—è—è</option>
<option value="purple">–§–∏–æ–ª–µ—Ç–æ–≤–∞—è</option>
</select><br>
<button onclick="join()">–í–æ–π—Ç–∏</button>
</div>

<div id="game">
<h3 id="players"></h3>
<div id="board-container">
<img src="board.jpg" id="board">
</div>
<div id="dice">üé≤</div>
<button onclick="roll()">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫</button>
<h3 id="info"></h3>
<div id="popup"></div>
</div>

<script>
const socket=io();
let currentRoom="";
let playerColor="";
let pieces={};
let positions=[
  [91,583],[102,450],[80,345],[99,232],[99,133],
  [218,97],[348,91],[500,88],[624,102],[762,91],
  [895,130],[912,204],[912,337],[909,425],[901,580],
  [771,588],[641,588],[483,594],[331,586],[218,594]
];
const cellTypes=["start","h3","h2","scandal","risk","h2","scandal","h3","h5",
  "zero","jail","h3","risk","h3","skip","h2","scandal","h8","zero","h4"];
const scandalTexts=[
"–ü–µ—Ä–µ–≥—Ä–µ–ª –∞—É–¥–∏—Ç–æ—Ä–∏—é üî• -1 —Ö–∞–π–ø",
"–ì—Ä–æ–º–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ ü´£ -2 —Ö–∞–π–ø",
"–≠—Ç–æ –º–æ–Ω—Ç–∞–∂ üò± -3 —Ö–∞–π–ø",
"–ú–µ–Ω—è –≤–∑–ª–æ–º–∞–ª–∏ #Ô∏è‚É£ -3 —Ö–∞–π–ø –≤—Å–µ–º",
"–ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –≤ —à–æ–∫–µ üòÆ -4 —Ö–∞–π–ø",
"–£–¥–∞–ª—è–π –ø–æ–∫–∞ –Ω–µ –ø–æ–∑–¥–Ω–æ ü§´ -5 —Ö–∞–π–ø",
"–≠—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç, –≤—ã –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç–µ üôÑ -5 —Ö–∞–π–ø + –ø—Ä–æ–ø—É—Å—Ç–∏ —Ö–æ–¥"
];

function join(){
  const name=document.getElementById("name").value;
  const room=document.getElementById("room").value;
  const color=document.getElementById("color").value;
  if(!name||!room) return;
  currentRoom=room;
  playerColor=color;
  socket.emit("joinRoom",{name,room,color});
  document.getElementById("lobby").style.display="none";
  document.getElementById("game").style.display="block";
}

function roll(){
  const dice=Math.floor(Math.random()*6)+1;
  document.getElementById("dice").innerText="üé≤ "+dice;
  document.getElementById("dice").animate([{transform:"rotate(0deg)"},{transform:`rotate(${Math.random()*720+360}deg)`}],
    {duration:800,fill:"forwards"});
  socket.emit("rollDice",{room:currentRoom});
}

socket.on("updateRoom", game=>{
  let text="";
  game.players.forEach(p=>{
    text+=p.name+" | –•–∞–π–ø: "+p.hype+"<br>";
    if(!pieces[p.id]){
      const div=document.createElement("div");
      div.className="piece "+p.color;
      div.style.left=positions[p.position][0]+"px";
      div.style.top=positions[p.position][1]+"px";
      document.getElementById("board-container").appendChild(div);
      pieces[p.id]=div;
    } else {
      // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ –≤—Å–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º –∫–ª–µ—Ç–∫–∞–º
      const start=pieces[p.id];
      start.style.left=positions[p.position][0]+"px";
      start.style.top=positions[p.position][1]+"px";
    }

    // –°–∫–∞–Ω–¥–∞–ª
    if(cellTypes[p.position]==="scandal" && p.id===game.players[game.turn].id){
      showPopup(scandalTexts[Math.floor(Math.random()*scandalTexts.length)]);
    }
    // –†–∏—Å–∫
    if(cellTypes[p.position]==="risk" && p.id===game.players[game.turn].id){
      showPopup("–†–∏—Å–∫! –ë—Ä–æ—Å–∞–µ–º –∫—É–±–∏–∫ –µ—â—ë —Ä–∞–∑!");
    }
  });

  document.getElementById("players").innerHTML=text;
  const current=game.players[game.turn];
  document.getElementById("info").innerText="–•–æ–¥ –∏–≥—Ä–æ–∫–∞: "+current.name;
});

socket.on("gameOver", winner=>{
  alert("–ü–æ–±–µ–¥–∏–ª "+winner.name+" üéâ");
});

function showPopup(text){
  const popup=document.getElementById("popup");
  popup.innerText=text;
  popup.style.display="block";
  setTimeout(()=>popup.style.display="none",3000);
}
</script>
</body>
</html>
