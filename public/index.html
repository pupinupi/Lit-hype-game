<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>–õ–∏—Ç–≤–∏–Ω. –ü—É—Ç—å –∫ —Ö–∞–π–ø—É</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body{font-family:Arial;text-align:center;background:#111;color:white;}
#board{
  position:relative;
  width:1024px;
  height:1024px;
  margin:auto;
  background:url("board.jpg");
  background-size:cover;
}
.token{
  width:30px;
  height:30px;
  border-radius:50%;
  position:absolute;
  transition: all 0.4s linear;
}
#dice{
  font-size:40px;
  margin:20px;
}
.colorPick{
  width:30px;
  height:30px;
  border-radius:50%;
  display:inline-block;
  cursor:pointer;
  margin:5px;
}
</style>
</head>
<body>

<div id="lobby">
  <h2>–õ–∏—Ç–≤–∏–Ω. –ü—É—Ç—å –∫ —Ö–∞–π–ø—É</h2>
  <input id="name" placeholder="–ò–º—è"><br><br>
  <input id="room" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã"><br><br>

  <div>
    <div class="colorPick" style="background:yellow" onclick="selectColor('yellow')"></div>
    <div class="colorPick" style="background:red" onclick="selectColor('red')"></div>
    <div class="colorPick" style="background:blue" onclick="selectColor('blue')"></div>
    <div class="colorPick" style="background:purple" onclick="selectColor('purple')"></div>
  </div><br>

  <button onclick="join()">–í–æ–π—Ç–∏</button>
</div>

<div id="game" style="display:none;">
  <div id="board"></div>
  <div id="dice">üé≤</div>
  <button onclick="rollDice()">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫</button>
</div>

<script>
const socket = io();

let myId=null;
let gameState=null;
let myColor="yellow";

const positions = [
{x:110,y:580},{x:110,y:500},{x:110,y:420},{x:110,y:340},{x:110,y:260},
{x:110,y:180},{x:200,y:120},{x:320,y:100},{x:450,y:100},{x:580,y:100},
{x:700,y:100},{x:820,y:120},{x:900,y:200},{x:900,y:320},{x:900,y:440},
{x:820,y:580},{x:700,y:580},{x:580,y:580},{x:450,y:580},{x:320,y:580}
];

function selectColor(c){ myColor=c; }

function join(){
  socket.emit("joinRoom",{
    name:document.getElementById("name").value,
    room:document.getElementById("room").value,
    color:myColor
  });
  document.getElementById("lobby").style.display="none";
  document.getElementById("game").style.display="block";
}

socket.on("playerId", id=> myId=id);

socket.on("updateRoom", state=>{
  gameState=state;
  render();
});

socket.on("showPopup", text=> alert(text));
socket.on("gameOver", w=> alert("–ü–æ–±–µ–¥–∏–ª: "+w.name));

function rollDice(){
  if(!gameState) return;
  const player = gameState.players[gameState.turn];
  if(player.id!==myId) return;
  const value=Math.floor(Math.random()*6)+1;
  document.getElementById("dice").innerText=value;
  socket.emit("rollDice",{room:document.getElementById("room").value,value});
}

function render(){
  const board=document.getElementById("board");
  board.innerHTML="";
  gameState.players.forEach(p=>{
    const t=document.createElement("div");
    t.className="token";
    t.style.background=p.color;
    const pos=positions[p.position];
    t.style.left=pos.x+"px";
    t.style.top=pos.y+"px";
    board.appendChild(t);
  });
}
</script>

</body>
</html>
